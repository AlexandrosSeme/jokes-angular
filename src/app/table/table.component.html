<div class="table-container p-4 bg-white rounded-lg">
    <div class="flex flex-wrap justify-end gap-4 mb-4">
        <div class="w-full sm:w-80">
            <div class="bg-white p-2 rounded-lg shadow-md">
                <div class="flex items-center gap-2">
                    <mat-form-field class="w-full">
                        <mat-label>Search</mat-label>
                        <input matInput [(ngModel)]="searchTerm" (input)="applyFilter()"
                            placeholder="Search by Name, Symbol, or Market Cap">
                        <mat-icon matSuffix>search</mat-icon>
                    </mat-form-field>
                    <button mat-fab class="resetButton" (click)="resetSearch()">
                        <mat-icon class="resetIcon">close</mat-icon>
                    </button>
                </div>
            </div>
        </div>
        <div class="w-full sm:w-80">
            <div class="bg-white p-2 rounded-lg shadow-md">
                <div class="flex items-center gap-2">
                    <mat-form-field class="w-full">
                        <mat-label>Select Symbols</mat-label>
                        <mat-select [formControl]="selectedSymbols" multiple (selectionChange)="applyFilter()">
                            <mat-select-trigger>
                                {{ selectedSymbols.value?.[0] || '' }}
                                @if ((selectedSymbols.value?.length || 0) > 1) {
                                @for (item of selectedSymbols.value; track $index) {
                                <span class="box-selection">{{item}},</span>
                                }
                                }
                            </mat-select-trigger>
                            <mat-option *ngFor="let symbol of availableSymbols" [value]="symbol">
                                {{ symbol }}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <button mat-fab class="resetButton" (click)="resetFilters()">
                        <mat-icon class="resetIcon">close</mat-icon>
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="bg-white p-1 rounded-lg shadow overflow-x-auto">
        <table mat-table [dataSource]="dataSource" matSort>
            <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    <strong>ID</strong>
                </th>
                <td mat-cell *matCellDef="let element"> {{ element.id }} </td>
            </ng-container>
            <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    <strong>Name</strong>
                </th>
                <td mat-cell *matCellDef="let element">{{ element.name }}</td>
            </ng-container>
            <ng-container matColumnDef="symbol">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    <strong>Symbol </strong>
                </th>
                <td mat-cell *matCellDef="let element">
                    {{ element.symbol | uppercase }}
                </td>
            </ng-container>
            <ng-container matColumnDef="current_price">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    <strong>Price (USD)</strong>
                </th>
                <td mat-cell *matCellDef="let element">
                    ${{ element.current_price | number:'1.2-2' }}
                </td>
            </ng-container>
            <ng-container matColumnDef="market_cap">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    <strong>Market Cap</strong>
                </th>
                <td mat-cell *matCellDef="let element">
                    ${{ element.market_cap | number }}
                </td>
            </ng-container>
            <ng-container matColumnDef="total_volume">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    <strong>Volume</strong>
                </th>
                <td mat-cell *matCellDef="let element">
                    ${{ element.total_volume | number }}
                </td>
            </ng-container>
            <ng-container matColumnDef="high_24h">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    <strong>High (24h)</strong>
                </th>
                <td mat-cell *matCellDef="let element">
                    ${{ element.high_24h | number:'1.2-2' }}
                </td>
            </ng-container>
            <ng-container matColumnDef="low_24h">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    <strong>Low (24h)</strong>
                </th>
                <td mat-cell *matCellDef="let element">
                    ${{ element.low_24h | number:'1.2-2' }}
                </td>
            </ng-container>
            <ng-container matColumnDef="price_change_percentage_24h">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    <strong>24h Change</strong>
                </th>
                <td mat-cell *matCellDef="let element" [ngClass]="{
                      'positive': element.price_change_percentage_24h > 0, 
                      'negative': element.price_change_percentage_24h < 0,
                      'neutral': element.price_change_percentage_24h === 0
                    }">
                    <mat-icon *ngIf="element.price_change_percentage_24h > 0"
                        class="positive-icon">trending_up</mat-icon>
                    <mat-icon *ngIf="element.price_change_percentage_24h < 0"
                        class="negative-icon">trending_down</mat-icon>
                    <mat-icon *ngIf="element.price_change_percentage_24h === 0" class="neutral-icon">remove</mat-icon>
                    {{ formatPercentage(element.price_change_percentage_24h) }}
                </td>
            </ng-container>
            <ng-container matColumnDef="circulating_supply">
                <th mat-header-cell *matHeaderCellDef mat-sort-header>
                    <strong>Circulating Supply</strong>
                </th>
                <td mat-cell *matCellDef="let element">
                    {{ element.circulating_supply | number }}
                </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
    </div>
    <mat-paginator [pageSize]="5" [pageSizeOptions]="[5, 10, 20, 50]" showFirstLastButtons (page)="pageSelect($event)">
    </mat-paginator>

</div>